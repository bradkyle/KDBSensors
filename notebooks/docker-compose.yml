
version: '2.1'

services:
  zookeeper:
    image: 'docker.io/bitnami/zookeeper:3-debian-10'
    ports:
      - '2181:2181'
    volumes:
      - 'zookeeper_data:/bitnami'
    environment:
      - ALLOW_ANONYMOUS_LOGIN=yes

  kafka:
    image: 'docker.io/bitnami/kafka:2-debian-10'
    ports:
      - '9092:9092'
    volumes:
      - 'kafka_data:/bitnami'
    environment:
      - KAFKA_CFG_ZOOKEEPER_CONNECT=zookeeper:2181
      - ALLOW_PLAINTEXT_LISTENER=yes
    depends_on:
      - zookeeper

  prometheus:
      image: prom/prometheus:v2.15.1
      volumes:
          - ./prometheus-linux.yml:/etc/prometheus/prometheus.yml
      ports:
          - 9090:9090

  grafana:
      image: grafana/grafana:6.5.2
      volumes:
          - ./grafana-config/:/etc/grafana/provisioning
      depends_on:
          - prometheus
      ports:
          - 3000:3000
      environment:
          - GF_SECURITY_ADMIN_PASSWORD=pass

  kdbj:
    image: gcr.io/practice-275123/kdbml-jupyter:v1.0 
    working_dir: /home/kx/mb
    entrypoint: /init bash -c "jupyter notebook --no-browser --ip=0.0.0.0 --port=5000" 
    ports:
      - "5000:5000"
    environment:
      KAFKA_PORT: 9092
    volumes:
      - ./:/home/kx/mb
    links:
      - "kafka"

volumes:
  zookeeper_data:
    driver: local
  kafka_data:
    driver: local
